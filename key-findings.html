<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Key Findings - RealPage Rent Impact Dashboard</title>
  <link rel="icon" type="image/png" href="photos/berkeleyischool-logo-vertical-blue-sm.png">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Sidebar styles */
    @media (min-width: 769px) {
      #sidebar-wrapper {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 250px;
      }

      #page-content-wrapper {
        margin-left: 250px;
      }

      #menu-toggle {
        display: none;
      }

      nav.navbar.fixed-top {
        display: none;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>
<body>
  <div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-light border-end" id="sidebar-wrapper">
      <div class="sidebar-heading text-center py-4">
        <img src="photos/berkeleyischool-logo-vertical-blue-sm.png" alt="UC Berkeley School of Information">
        <h2 class="mids-capstone">
          MIDS Capstone: <strong>RealPage Rent Impact Dashboard</strong>
        </h2>
      </div>
      <div class="list-group list-group-flush">
        <a href="index.html" class="list-group-item list-group-item-action bg-light">
          Homepage
        </a>
        <!-- Updated link: index.html -> about.html -->
        <a href="about.html" class="list-group-item list-group-item-action bg-light">
          About
        </a>
        <a href="data-dictionary.html" class="list-group-item list-group-item-action bg-light">
          Data Dictionary
        </a>
        <!-- Updated eda.html -> interactive-map.html -->
        <a href="interactive-map.html" class="list-group-item list-group-item-action bg-light">
          Interactive Map
        </a>
        <a href="key-findings.html" class="list-group-item list-group-item-action bg-light active">
          Key Findings
        </a>
        <a href="demo.html" class="list-group-item list-group-item-action bg-light">
          Try It Yourself: Interactive Modeling
        </a>
        <a href="contact-us.html" class="list-group-item list-group-item-action bg-light">
          Contact Us
        </a>
      </div>
      <div class="p-3">
        <a href="research-paper.pdf" target="_blank" class="btn btn-primary w-100">
          View Research Paper
        </a>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->
    
    <!-- Page Content -->
    <div id="page-content-wrapper">
      <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom mobile-only">
        <div class="container-fluid">
          <button class="btn btn-secondary" id="menu-toggle">
            MIDS Capstone, Spring 2025: RealPage Rent Impact Dashboard
          </button>
        </div>
      </nav>
      
      <div class="container-fluid py-4">
        <!-- Page Title / Intro -->
        <div class="mb-4">
          <h1 class="display-5">Key Findings</h1>
          <p class="text-muted">
            This page explores key patterns in rent pricing using updated difference-in-differences methods and non-causal models. 
            Rather than asserting definitive collusion, our analyses highlight statistically significant rent impacts associated with RealPage usage. 
            Management Named in Lawsuits Against RealPage are grouped for comparison throughout.
          </p>          
        </div>
        
        <!-- Visualization Card -->
        <div class="mb-3">
          <label for="stateFilter" class="form-label">Filter by State:</label>
          <select id="stateFilter" class="form-select" style="max-width: 300px;">
            <option value="">All States</option>
          </select>
        </div>        
        <div id="keyFindingsChart" style="height:500px;"></div>
        <p class="text-muted" style="margin-top:1rem;">
          This chart compares rent levels by metro, grouped by 'Management Named in Lawsuits Against RealPage'.
        </p>
        <h2 class="mt-5">üìä Current Rent vs. Annual Rent Growth (Dual-Axis View)</h2>
        <canvas id="comboChart" style="max-height:500px;"></canvas>
        <p class="text-muted" style="margin-top:1rem;">
          This chart compares current rent levels with annual rent growth, providing a dual-axis view of the data.
        </p>
        <h2>üìç Predicted vs Actual Rent by Property</h2>
        <canvas id="predictionChart" style="height:500px;"></canvas>
        <p class="text-muted" style="margin-top:1rem;">
          This scatter plot compares predicted rent prices against actual rent prices, with a line indicating perfect prediction.
        </p>

      </div>
      <!-- Footer -->
      <footer class="bg-light text-center py-3 mt-5 border-top">
        <p class="mb-0">
          &copy; 2025 RealPage Rent Impact Dashboard &mdash; 
          <a href="privacy.html">View Full Privacy Policy</a>
        </p>
      </footer>
    </div>
    <!-- /#page-content-wrapper -->
  </div>
  <!-- /#wrapper -->

  <!-- Chart Code -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const container = document.getElementById("keyFindingsChart");
      const canvas = document.createElement("canvas");
      container.appendChild(canvas);
      const ctx = canvas.getContext("2d");
    
      let chart; // Store the Chart.js instance
      let parsedData = [];
    
      function updateChart(filteredState = "") {
        const cityGroups = {};
    
        parsedData.forEach(row => {
          if (filteredState && row.state !== filteredState) return;
    
          const city = row.city;
          const rent = parseFloat(row["MPF-RENT"]);
          const usesRealPage = row.uses_realpage === "1" ? "RealPage" : "Not RealPage";
    
          if (!city || isNaN(rent)) return;
          if (!cityGroups[city]) cityGroups[city] = { "RealPage": [], "Not RealPage": [] };
          cityGroups[city][usesRealPage].push(rent);
        });
    
        const labels = [];
        const realpageAverages = [];
        const otherAverages = [];
    
        for (let city in cityGroups) {
          const group = cityGroups[city];
          if (group["RealPage"].length && group["Not RealPage"].length) {
            labels.push(city);
            realpageAverages.push(group["RealPage"].reduce((a, b) => a + b, 0) / group["RealPage"].length);
            otherAverages.push(group["Not RealPage"].reduce((a, b) => a + b, 0) / group["Not RealPage"].length);
          }
        }
    
        if (chart) chart.destroy(); // Remove old chart
        chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: "RealPage",
                data: realpageAverages,
                backgroundColor: "rgba(0,123,255,0.7)"
              },
              {
                label: "Not RealPage",
                data: otherAverages,
                backgroundColor: "rgba(108,117,125,0.7)"
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: "Rent Impact by RealPage Involvement (by City)"
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Rent ($)" }
              }
            }
          }
        });
      }
    
      // Load CSV
      fetch("https://rpc-webpage.s3-accelerate.amazonaws.com/cbsa_data_final.csv")
        .then(res => res.text())
        .then(csv => {
          Papa.parse(csv, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              parsedData = results.data;
    
              // Populate state filter
              const stateFilter = document.getElementById("stateFilter");
              const states = [...new Set(parsedData.map(d => d.state).filter(Boolean))].sort();
              states.forEach(state => {
                const option = document.createElement("option");
                option.value = state;
                option.textContent = state;
                stateFilter.appendChild(option);
              });
    
              // Initial chart
              updateChart();
    
              // Filter change
              stateFilter.addEventListener("change", function () {
                updateChart(this.value);
              });
            }
          });
        });
    });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('comboChart').getContext('2d');
      
        fetch("https://rpc-webpage.s3-accelerate.amazonaws.com/cbsa_data_final.csv")
          .then(res => res.text())
          .then(csv => {
            Papa.parse(csv, {
              header: true,
              skipEmptyLines: true,
              complete: function(results) {
                const data = results.data;
                const yearMap = {};
      
                data.forEach(row => {
                  const year = parseInt(row.yearBuilt);
                  const rent = parseFloat(row["MPF-RENT"]);
                  const growth = parseFloat(row["MPF-ANN-RENT-CHG"]);
      
                  if (!isNaN(year) && year >= 1950 && year <= 2025 && !isNaN(rent) && !isNaN(growth)) {
                    if (!yearMap[year]) {
                      yearMap[year] = { rentTotal: 0, growthTotal: 0, count: 0 };
                    }
                    yearMap[year].rentTotal += rent;
                    yearMap[year].growthTotal += growth;
                    yearMap[year].count++;
                  }
                });
      
                const labels = [];
                const avgRent = [];
                const avgGrowth = [];
      
                Object.entries(yearMap).forEach(([year, stats]) => {
                  if (stats.count >= 5) {
                    labels.push(year);
                    avgRent.push(stats.rentTotal / stats.count);
                    avgGrowth.push((stats.growthTotal / stats.count) * 100); // convert to %
                  }
                });
      
                new Chart(ctx, {
                  type: 'bar',
                  data: {
                    labels,
                    datasets: [
                      {
                        type: 'bar',
                        label: 'Avg Rent ($)',
                        data: avgRent,
                        backgroundColor: 'rgba(0, 123, 255, 0.7)',
                        yAxisID: 'y'
                      },
                      {
                        type: 'line',
                        label: 'Rent Growth (%)',
                        data: avgGrowth,
                        borderColor: 'rgba(220, 53, 69, 1)',
                        backgroundColor: 'rgba(220, 53, 69, 0.3)',
                        yAxisID: 'y1',
                        fill: false
                      }
                    ]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      title: {
                        display: true,
                        text: 'Rent and Rent Growth by Year Built'
                      }
                    },
                    scales: {
                      y: {
                        beginAtZero: true,
                        title: {
                          display: true,
                          text: 'Average Rent ($)'
                        }
                      },
                      y1: {
                        beginAtZero: true,
                        position: 'right',
                        grid: { drawOnChartArea: false },
                        title: {
                          display: true,
                          text: 'Annual Rent Growth (%)'
                        }
                      }
                    }
                  }
                });
              }
            });
          });
      });
      </script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
      <script>
      document.addEventListener("DOMContentLoaded", function () {
        const canvas = document.getElementById("predictionChart").getContext("2d");
      
        fetch("https://rpc-webpage.s3-accelerate.amazonaws.com/cbsa_data_final.csv")
          .then(res => res.text())
          .then(csv => {
            Papa.parse(csv, {
              header: true,
              skipEmptyLines: true,
              complete: function(results) {
                const data = results.data;
      
                const realPagePoints = [];
                const otherPoints = [];
      
                data.forEach(row => {
                  const actual = parseFloat(row["MPF-RENT"]);
                  const predicted = parseFloat(row["MPF-HIST-ASK-RENT"]);
                  const source = row["uses_realpage"];
      
                  if (!isNaN(actual) && !isNaN(predicted)) {
                    const point = {
                      x: actual,
                      y: predicted,
                      tooltip: row["propertyName"] || ""
                    };
                    (source === "1" ? realPagePoints : otherPoints).push(point);
                  }
                });
      
                new Chart(canvas, {
                  type: "scatter",
                  data: {
                    datasets: [
                      {
                        label: "RealPage",
                        data: realPagePoints,
                        backgroundColor: "rgba(255,99,132,0.8)",
                        pointRadius: 4
                      },
                      {
                        label: "Not RealPage",
                        data: otherPoints,
                        backgroundColor: "rgba(54,162,235,0.8)",
                        pointRadius: 4
                      },
                      {
                        type: "line",
                        label: "Perfect Fit (y = x)",
                        data: Array.from({length: 100}, (_, i) => ({ x: i * 100, y: i * 100 })),
                        borderColor: "rgba(0,0,0,0.3)",
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: false
                      }
                    ]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      tooltip: {
                        callbacks: {
                          label: function(context) {
                            return `${context.dataset.label}: Predicted $${context.parsed.y.toFixed(0)}, Actual $${context.parsed.x.toFixed(0)}`;
                          }
                        }
                      },
                      title: {
                        display: true,
                        text: "Predicted vs Actual Rent Prices"
                      }
                    },
                    scales: {
                      x: {
                        title: { display: true, text: "Actual Rent Price ($)" },
                        min: 0
                      },
                      y: {
                        title: { display: true, text: "Predicted Rent Price ($)" },
                        min: 0
                      }
                    }
                  }
                });
              }
            });
          });
      });
      </script>
</body>
</html>
